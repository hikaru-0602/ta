/*
 * ğŸ“š ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Œçµ¦æ–™è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ ã€ã®ãƒ†ã‚¹ãƒˆã§ã™
 *
 * ã€ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹ã€‘
 * - å­¦å¹´åˆ¥ã®æ™‚çµ¦è¨­å®šãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹
 * - åŠ´åƒæ™‚é–“ã‹ã‚‰çµ¦æ–™ã¸ã®è¨ˆç®—ãŒæ­£ç¢ºã‹
 * - è¤‡æ•°ã‚·ãƒ•ãƒˆã®æœˆé–“çµ¦æ–™è¨ˆç®—ãŒæ­£ã—ã„ã‹
 *
 * ã€ãªãœãƒ†ã‚¹ãƒˆãŒå¿…è¦ã‹ã€‘
 * - çµ¦æ–™è¨ˆç®—ã¯é‡‘éŠ­ã«é–¢ã‚ã‚‹æœ€é‡è¦æ©Ÿèƒ½
 * - è¨ˆç®—ãƒŸã‚¹ = çµ¦æ–™ã®æ”¯æ‰•ã„ãƒŸã‚¹ = å¤§å•é¡Œ
 * - å­¦å¹´ã”ã¨ã®æ™‚çµ¦è¨­å®šã€æ™‚é–“è¨ˆç®—ã€å››æ¨äº”å…¥å‡¦ç†ãªã©ã®è¤‡é›‘ãªè¨ˆç®—ã‚’æ­£ç¢ºã«è¡Œã†å¿…è¦
 *
 * ã€å®Ÿéš›ã®ä½¿ç”¨ä¾‹ã€‘
 * - å­¦éƒ¨1å¹´ç”ŸãŒæœˆ20æ™‚é–“åƒã„ãŸå ´åˆã®çµ¦æ–™è¨ˆç®—
 * - è¤‡æ•°ç§‘ç›®ã€è¤‡æ•°ã‚·ãƒ•ãƒˆã®æœˆé–“åˆè¨ˆçµ¦æ–™è¨ˆç®—
 * - å­¦å¹´ã«ã‚ˆã‚‹æ™‚çµ¦å·®ã®æ­£ç¢ºãªåæ˜ 
 */

// çµ¦æ–™è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ

// gradeInfoMapã®æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿
const gradeInfoMap = {
  "1": { label: "å­¦éƒ¨ï¼‘å¹´ç”Ÿ", wage: 1010 },
  "2": { label: "å­¦éƒ¨ï¼’å¹´ç”Ÿ", wage: 1020 },
  "3": { label: "å­¦éƒ¨ï¼“å¹´ç”Ÿ", wage: 1030 },
  "4": { label: "å­¦éƒ¨ï¼”å¹´ç”Ÿ", wage: 1040 },
  "5": { label: "ä¿®å£«ï¼‘å¹´ç”Ÿ", wage: 1200 },
  "6": { label: "ä¿®å£«ï¼’å¹´ç”Ÿ", wage: 1210 },
  "7": { label: "åšå£«ï¼‘å¹´ç”Ÿ", wage: 1400 },
  "8": { label: "åšå£«ï¼’å¹´ç”Ÿ", wage: 1410 },
  "9": { label: "åšå£«ï¼“å¹´ç”Ÿ", wage: 1420 }
};

// çµ¦æ–™è¨ˆç®—é–¢æ•°
const calculateSalary = (totalMinutes, gradeValue) => {
  const gradeInfo = gradeInfoMap[gradeValue] || gradeInfoMap["1"];
  const hourlyRate = gradeInfo.wage;
  const totalHours = totalMinutes / 60;
  return Math.round(totalHours * hourlyRate);
};

// æœˆé–“çµ¦æ–™è¨ˆç®—ï¼ˆè¤‡æ•°ã‚·ãƒ•ãƒˆã‹ã‚‰ï¼‰
const calculateMonthlySalary = (shifts, gradeValue) => {
  const totalMinutes = shifts.reduce((sum, shift) => {
    const startMinutes = timeToMinutes(shift.starttime);
    const endMinutes = timeToMinutes(shift.endtime);
    const breakMinutes = shift.breaktime || 0;
    const workTime = Math.max(0, endMinutes - startMinutes - breakMinutes);
    return sum + workTime;
  }, 0);

  return calculateSalary(totalMinutes, gradeValue);
};

// æ™‚åˆ»ã‚’åˆ†ã«å¤‰æ›ï¼ˆå†åˆ©ç”¨ï¼‰
const timeToMinutes = (time) => {
  if (!time || !time.includes(':')) return 0;
  const [hours, minutes] = time.split(':').map(Number);
  if (isNaN(hours) || isNaN(minutes)) return 0;
  return hours * 60 + minutes;
};

describe('çµ¦æ–™è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ ', () => {
  describe('calculateSalary é–¢æ•°', () => {
    test('å­¦éƒ¨1å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - 1.5æ™‚é–“ï¼ˆ90åˆ†ï¼‰åƒã„ãŸå­¦éƒ¨1å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—
       * - 1.5æ™‚é–“ Ã— 1010å††/æ™‚ = 1515å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - æœ€ã‚‚åŸºæœ¬çš„ãªçµ¦æ–™è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³
       * - æ™‚é–“å˜ä¾¡è¨ˆç®—ã®æ­£ç¢ºæ€§ç¢ºèª
       * - å®Ÿéš›ã®çµ¦æ–™æ˜ç´°ã«ç›´çµã™ã‚‹é‡è¦ãªè¨ˆç®—
       */
      const totalMinutes = 90; // 1.5æ™‚é–“
      const salary = calculateSalary(totalMinutes, "1");

      expect(salary).toBe(1515); // 1.5 Ã— 1010 = 1515å††
    });

    test('ä¿®å£«1å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - 2æ™‚é–“åƒã„ãŸä¿®å£«1å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—
       * - 2æ™‚é–“ Ã— 1200å††/æ™‚ = 2400å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å­¦å¹´ã«ã‚ˆã‚‹æ™‚çµ¦å·®ã®æ­£ç¢ºãªåæ˜ ç¢ºèª
       * - å­¦éƒ¨ç”Ÿã¨å¤§å­¦é™¢ç”Ÿã®æ™‚çµ¦è¨­å®šãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèª
       */
      const totalMinutes = 120; // 2æ™‚é–“
      const salary = calculateSalary(totalMinutes, "5");

      expect(salary).toBe(2400); // 2 Ã— 1200 = 2400å††
    });

    test('åšå£«3å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - 3æ™‚é–“åƒã„ãŸåšå£«3å¹´ç”Ÿã®çµ¦æ–™è¨ˆç®—
       * - 3æ™‚é–“ Ã— 1420å††/æ™‚ = 4260å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - æœ€é«˜æ™‚çµ¦ãƒ¬ãƒ™ãƒ«ã®è¨ˆç®—ç¢ºèª
       * - å­¦å¹´é€²è¡Œã«ã‚ˆã‚‹æ™‚çµ¦ä¸Šæ˜‡ãŒæ­£ã—ãåæ˜ ã•ã‚Œã‚‹ã‹ç¢ºèª
       */
      const totalMinutes = 180; // 3æ™‚é–“
      const salary = calculateSalary(totalMinutes, "9");

      expect(salary).toBe(4260); // 3 Ã— 1420 = 4260å††
    });

    test('ä¸æ­£ãªå­¦å¹´ã®å ´åˆã¯å­¦éƒ¨1å¹´ç”Ÿã®æ™‚çµ¦ã‚’ä½¿ç”¨', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - ä¸æ­£ãªå­¦å¹´ã‚³ãƒ¼ãƒ‰ï¼ˆ"invalid"ï¼‰ã‚’å…¥åŠ›
       * - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å­¦éƒ¨1å¹´ç”Ÿã®æ™‚çµ¦ï¼ˆ1010å††ï¼‰ã‚’é©ç”¨
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒŸã‚¹ã‚„ä¸æ­£å€¤ã¸ã®å®‰å…¨ãªå¯¾å‡¦
       * - ã‚·ã‚¹ãƒ†ãƒ ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã›ãšã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ç¶™ç¶šå‹•ä½œ
       * - æœ€ä½æ™‚çµ¦ä¿è¨¼ã«ã‚ˆã‚‹æœ€æ‚ªã‚±ãƒ¼ã‚¹å›é¿
       */
      const totalMinutes = 60; // 1æ™‚é–“
      const salary = calculateSalary(totalMinutes, "invalid");

      expect(salary).toBe(1010); // 1 Ã— 1010 = 1010å††ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    });

    test('ç«¯æ•°ã®å‡¦ç†ï¼ˆå››æ¨äº”å…¥ï¼‰', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - 1æ™‚é–“40åˆ†ï¼ˆ1.666...æ™‚é–“ï¼‰ã®çµ¦æ–™è¨ˆç®—
       * - 1.666... Ã— 1010 = 1683.33... â†’ 1683å††ï¼ˆå››æ¨äº”å…¥ï¼‰
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å®Ÿéš›ã®å‹¤å‹™ã§ã¯åˆ†å˜ä½ã§ã®ç«¯æ•°ãŒç™ºç”Ÿã™ã‚‹
       * - çµ¦æ–™ã®ç«¯æ•°å‡¦ç†ãŒæ­£ç¢ºã«è¡Œã‚ã‚Œã‚‹ã‹ç¢ºèª
       * - æ³•çš„ã«ã‚‚é‡è¦ãªç«¯æ•°å‡¦ç†è¦å‰‡ã®å®Ÿè£…ç¢ºèª
       */
      const totalMinutes = 100; // 1æ™‚é–“40åˆ† = 1.666...æ™‚é–“
      const salary = calculateSalary(totalMinutes, "1");

      expect(salary).toBe(1683); // 1.666... Ã— 1010 = 1683.33... â†’ 1683å††
    });
  });

  describe('calculateMonthlySalary é–¢æ•°', () => {
    test('è¤‡æ•°ã‚·ãƒ•ãƒˆã®æœˆé–“çµ¦æ–™è¨ˆç®—', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - 3å›ã®ã‚·ãƒ•ãƒˆï¼ˆå„90åˆ†ï¼‰ã®æœˆé–“åˆè¨ˆçµ¦æ–™è¨ˆç®—
       * - åˆè¨ˆ270åˆ†ï¼ˆ4.5æ™‚é–“ï¼‰Ã— 1010å††/æ™‚ = 4545å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å®Ÿéš›ã®æœˆæœ«çµ¦æ–™è¨ˆç®—ã®ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½
       * - è¤‡æ•°ã‚·ãƒ•ãƒˆã®æ™‚é–“åˆç®—ãŒæ­£ç¢ºã«è¡Œã‚ã‚Œã‚‹ã‹ç¢ºèª
       * - æœˆé–“åŠ´åƒå®Ÿç¸¾ã®æ­£ç¢ºãªé‡‘é¡æ›ç®—
       */
      const shifts = [
        {
          starttime: '09:00',
          endtime: '10:30',
          breaktime: 0
        },
        {
          starttime: '10:40',
          endtime: '12:10',
          breaktime: 0
        },
        {
          starttime: '13:10',
          endtime: '14:40',
          breaktime: 0
        }
      ];

      const salary = calculateMonthlySalary(shifts, "1");

      // å„ã‚·ãƒ•ãƒˆ90åˆ† Ã— 3 = 270åˆ† = 4.5æ™‚é–“
      // 4.5 Ã— 1010 = 4545å††
      expect(salary).toBe(4545);
    });

    test('ä¼‘æ†©æ™‚é–“ã‚’å«ã‚€ã‚·ãƒ•ãƒˆã®è¨ˆç®—', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - ä¼‘æ†©æ™‚é–“ã‚ã‚Šã®ã‚·ãƒ•ãƒˆã®æ­£ç¢ºãªè¨ˆç®—
       * - 1å›ç›®ï¼š3æ™‚é–“-1æ™‚é–“ä¼‘æ†©=2æ™‚é–“ã€2å›ç›®ï¼š2æ™‚é–“
       * - åˆè¨ˆ4æ™‚é–“ Ã— 1020å††/æ™‚ = 4080å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - ä¼‘æ†©æ™‚é–“ã®æ§é™¤ãŒæ­£ç¢ºã«è¡Œã‚ã‚Œã‚‹ã‹ç¢ºèª
       * - å®Ÿéš›ã®TAæ¥­å‹™ã§ã¯æ˜¼ä¼‘æ†©ç­‰ã®ä¼‘æ†©æ™‚é–“ãŒç™ºç”Ÿ
       * - åŠ´åƒåŸºæº–æ³•ã«åŸºã¥ãé©åˆ‡ãªä¼‘æ†©æ™‚é–“å‡¦ç†
       */
      const shifts = [
        {
          starttime: '09:00',
          endtime: '12:00',
          breaktime: 60 // 1æ™‚é–“ä¼‘æ†©
        },
        {
          starttime: '13:00',
          endtime: '15:00',
          breaktime: 0
        }
      ];

      const salary = calculateMonthlySalary(shifts, "2");

      // 1å›ç›®: 3æ™‚é–“ - 1æ™‚é–“ä¼‘æ†© = 2æ™‚é–“ = 120åˆ†
      // 2å›ç›®: 2æ™‚é–“ = 120åˆ†
      // åˆè¨ˆ: 240åˆ† = 4æ™‚é–“
      // 4 Ã— 1020 = 4080å††
      expect(salary).toBe(4080);
    });

    test('ã‚·ãƒ•ãƒˆãŒãªã„å ´åˆã¯0å††', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - ç©ºã®ã‚·ãƒ•ãƒˆé…åˆ—ã§ã®çµ¦æ–™è¨ˆç®—
       * - çµæœã¯0å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å‹¤å‹™å®Ÿç¸¾ãŒãªã„æœˆã®æ­£ã—ã„å‡¦ç†
       * - ã‚·ã‚¹ãƒ†ãƒ ãŒã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã•ãšã«0å††ã‚’è¿”ã™ã‹ç¢ºèª
       * - ç©ºãƒ‡ãƒ¼ã‚¿ã§ã®å®‰å…¨ãªå‹•ä½œä¿è¨¼
       */
      const shifts = [];
      const salary = calculateMonthlySalary(shifts, "1");

      expect(salary).toBe(0);
    });
  });

  describe('å®Ÿéš›ã®TAæ¥­å‹™ã‚·ãƒŠãƒªã‚ª', () => {
    test('é€±3å›ã€æœˆ12å›ã®TAæ¥­å‹™', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - å®Ÿéš›ã®TAæ¥­å‹™ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆé€±3å›Ã—4é€±=æœˆ12å›ï¼‰
       * - 1å›ã‚ãŸã‚Šï¼š8:50-12:10ï¼ˆæº–å‚™è¾¼ã¿ï¼‰ã€ä¼‘æ†©10åˆ†
       * - æœˆé–“åˆè¨ˆï¼š38æ™‚é–“ Ã— 1010å†† = 38380å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å®Ÿéš›ã®TAæ¥­å‹™ã§ã®å…¸å‹çš„ãªå‹¤å‹™ãƒ‘ã‚¿ãƒ¼ãƒ³
       * - æº–å‚™æ™‚é–“ã‚’å«ã‚€å®Ÿå‹™çš„ãªæ™‚é–“è¨ˆç®—
       * - æœˆæœ«ã®å®Ÿéš›ã®çµ¦æ–™é‡‘é¡ã¨ã®æ•´åˆæ€§ç¢ºèª
       */
      // 1å›ã‚ãŸã‚Š1é™+2é™ï¼ˆæº–å‚™10åˆ†å«ã‚€ï¼‰
      const singleShift = {
        starttime: '08:50', // 10åˆ†å‰æº–å‚™
        endtime: '12:10',   // 2é™çµ‚äº†
        breaktime: 10       // é™é–“ä¼‘æ†©
      };

      // æœˆ12å›åˆ†ã®ã‚·ãƒ•ãƒˆ
      const monthlyShifts = Array(12).fill(singleShift);

      const salary = calculateMonthlySalary(monthlyShifts, "1");

      // 1å›ã‚ãŸã‚Š: 200åˆ† - 10åˆ†ä¼‘æ†© = 190åˆ†
      // 12å›: 190 Ã— 12 = 2280åˆ† = 38æ™‚é–“
      // 38 Ã— 1010 = 38380å††
      expect(salary).toBe(38380);
    });

    test('å­¦å¹´ã«ã‚ˆã‚‹çµ¦æ–™ã®é•ã„', () => {
      /*
       * ğŸ§ª ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ï¼š
       * - åŒã˜å‹¤å‹™æ™‚é–“ã§ã®å­¦å¹´åˆ¥çµ¦æ–™æ¯”è¼ƒ
       * - å­¦éƒ¨1å¹´ï¼š2020å††ã€ä¿®å£«1å¹´ï¼š2400å††ã€åšå£«3å¹´ï¼š2840å††
       *
       * ğŸ’¡ ãªãœã“ã®ãƒ†ã‚¹ãƒˆãŒé‡è¦ï¼Ÿ
       * - å­¦å¹´é€²è¡Œã«ã‚ˆã‚‹æ™‚çµ¦ä¸Šæ˜‡ã®æ­£ç¢ºãªåæ˜ ç¢ºèª
       * - åŒã˜åŠ´åƒã§ã‚‚å­¦å¹´ã«ã‚ˆã‚Šçµ¦æ–™å·®ãŒã‚ã‚‹ã“ã¨ã®å®Ÿè£…ç¢ºèª
       * - å…¬å¹³æ€§ã¨å­¦å¹´ã«å¿œã˜ãŸå¾…é‡å·®ã®é©åˆ‡ãªè¨ˆç®—
       */
      const shifts = [
        {
          starttime: '09:00',
          endtime: '12:00',
          breaktime: 60
        }
      ];

      // åŒã˜å‹¤å‹™æ™‚é–“ï¼ˆ2æ™‚é–“ï¼‰ã§ã®å­¦å¹´åˆ¥çµ¦æ–™
      const undergrad1 = calculateMonthlySalary(shifts, "1"); // 1010å††/æ™‚
      const master1 = calculateMonthlySalary(shifts, "5");    // 1200å††/æ™‚
      const phd3 = calculateMonthlySalary(shifts, "9");       // 1420å††/æ™‚

      expect(undergrad1).toBe(2020); // 2 Ã— 1010
      expect(master1).toBe(2400);    // 2 Ã— 1200
      expect(phd3).toBe(2840);       // 2 Ã— 1420

      // å­¦å¹´ãŒä¸ŠãŒã‚‹ã»ã©çµ¦æ–™ãŒé«˜ã„
      expect(master1).toBeGreaterThan(undergrad1);
      expect(phd3).toBeGreaterThan(master1);
    });
  });
});